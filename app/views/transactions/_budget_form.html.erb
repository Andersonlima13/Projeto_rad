<!-- app/views/transactions/_budget_form.html.erb -->
<div class="card mt-4">
  <div class="card-header bg-info text-white">
    <h6 class="card-title mb-0">
      <i class="fas fa-piggy-bank me-2"></i>Gerenciar Orçamentos
    </h6>
  </div>
  <div class="card-body">
    <%= form_with(model: [current_user, Category.new], local: true, class: "row g-3") do |form| %>
      <div class="col-md-5">
        <%= form.label :name, "Nome do Orçamento *", class: "form-label" %>
        <%= form.text_field :name, class: "form-control", required: true, placeholder: "Ex: Alimentação, Transporte..." %>
      </div>
      
      <div class="col-md-4">
        <%= form.label :budget_amount, "Valor do Orçamento *", class: "form-label" %>
        <%= form.number_field :budget_amount, step: 0.01, class: "form-control", required: true, min: 0.01 %>
      </div>
      
      <div class="col-md-3">
        <label class="form-label">&nbsp;</label>
        <%= form.submit "Criar Orçamento", class: "btn btn-primary w-100" %>
      </div>
      
      <div class="col-12">
        <small class="text-muted">
          Saldo disponível: <%= number_to_currency(current_user.accounts.sum(:limit)) %>
        </small>
      </div>
    <% end %>
    
    <!-- Lista de orçamentos existentes -->
    <% if current_user.categories.with_budget.any? %>
      <div class="mt-3">
        <h6 class="border-bottom pb-2">Seus Orçamentos</h6>
        <div class="list-group">
          <% current_user.categories.with_budget.each do |category| %>
            <div class="list-group-item">
              <div class="d-flex justify-content-between align-items-center">
                <div>
                  <strong><%= category.name %></strong>
                  <br>
                  <small class="text-muted">
                    Orçamento: <%= number_to_currency(category.budget_amount) %> | 
                    Gasto: <%= number_to_currency(category.spent_amount) %> | 
                    Restante: <span class="<%= category.remaining_budget >= 0 ? 'text-success' : 'text-danger' %>">
                      <%= number_to_currency(category.remaining_budget) %>
                    </span>
                  </small>
                </div>
                <span class="badge bg-<%= category.budget_exceeded? ? 'danger' : 'success' %>">
                  <%= category.budget_exceeded? ? 'Estourado' : 'Dentro do orçamento' %>
                </span>
              </div>
            </div>
          <% end %>
        </div>
      </div>
    <% end %>
  </div>
</div>