<!-- app/views/transactions/index.html.erb -->
<div class="container">




  <!-- DEBUG: Remova depois -->
  <div class="alert alert-info">
    <strong>DEBUG:</strong><br>
    Account ID: <%= params[:account_id] %><br>
    @account: <%= @account&.inspect %><br>
    Transactions count: <%= @transactions.count %>
  </div>
  <!-- Fim do DEBUG -->



  <div class="d-flex justify-content-between align-items-center mb-4">
    <div>
      <% if @account %>
        <h1>Transações da Conta: <%= @account.name %></h1>
        <p class="text-muted">
          Limite: <%= number_to_currency(@account.limit) %> | 
          Saldo Disponível: <span class="<%= @account.current_balance >= 0 ? 'text-success' : 'text-danger' %>">
            <%= number_to_currency(@account.current_balance) %>
          </span>
        </p>
      <% else %>
        <h1>Todas as Transações</h1>
        <p class="text-muted">Transações de todas as suas contas</p>
      <% end %>
    </div>
    <div>
      <% if @account %>
        <%= link_to "Nova Receita", new_account_transaction_path(@account, type: 'income'), 
                    class: "btn btn-success me-2" %>
        <%= link_to "Nova Despesa", new_account_transaction_path(@account, type: 'expense'), 
                    class: "btn btn-danger me-2" %>
        <%= link_to "Voltar para Conta", account_path(@account), class: "btn btn-secondary" %>
      <% else %>
        <%= link_to "Voltar para Contas", accounts_path, class: "btn btn-secondary" %>
      <% end %>
    </div>
  </div>

  <% if flash[:alert] %>
    <div class="alert alert-warning"><%= flash[:alert] %></div>
  <% end %>

  <div class="card">
    <div class="card-header">
      <h5 class="card-title mb-0">
        <% if @account %>
          Histórico de Transações
        <% else %>
          Transações de Todas as Contas
        <% end %>
      </h5>
    </div>
    <div class="card-body">
      <% if @transactions.any? %>
        <div class="table-responsive">
          <table class="table table-striped">
            <thead>
              <tr>
                <th>Data</th>
                <th>Descrição</th>
                <th>Conta</th>
                <th>Categoria</th>
                <th>Tipo</th>
                <th>Valor</th>
                <th>Ações</th>
              </tr>
            </thead>
            <tbody>
              <% @transactions.each do |transaction| %>
                <tr>
                  <td><%= l(transaction.date, format: :short) %></td>
                  <td><%= transaction.description %></td>
                  <td><%= transaction.account.name %></td>
                  <td><%= transaction.category&.name || 'Nenhuma' %></td>
                  <td>
                    <span class="badge bg-<%= transaction.transaction_type == 'income' ? 'success' : 'danger' %>">
                      <%= transaction.transaction_type == 'income' ? 'Receita' : 'Despesa' %>
                    </span>
                  </td>
                  <td class="<%= transaction.transaction_type == 'income' ? 'text-success' : 'text-danger' %>">
                    <%= number_to_currency(transaction.amount) %>
                  </td>
                  <td>
                    <%= link_to "Editar", edit_account_transaction_path(transaction.account, transaction), 
                                class: "btn btn-sm btn-outline-secondary me-1" %>
                    <%= button_to "Excluir", account_transaction_path(transaction.account, transaction), 
                                 method: :delete,
                                 data: { turbo_confirm: 'Tem certeza?' },
                                 class: "btn btn-sm btn-outline-danger" %>
                  </td>
                </tr>
              <% end %>
            </tbody>
          </table>
        </div>
      <% else %>
        <p class="text-muted text-center">Nenhuma transação encontrada.</p>
      <% end %>
    </div>
  </div>
</div>

